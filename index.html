<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>在席確認表【開発用】</title>

<!-- 強めのキャッシュ抑止（HTMLに効く） -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<!-- CSP：Worker への POST を許可（本番＝-test を指す） -->
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self';
               connect-src 'self' https://presence-proxy-test.taka-hiyo.workers.dev;
               style-src 'self';
               img-src 'self' data:;
               object-src 'none'">
<link rel="stylesheet" href="styles.css">
      
</head>
<body>
<header>
    <div class="title-wrap">
      <button id="titleBtn" class="title-btn" aria-haspopup="true" aria-expanded="false" aria-controls="groupMenu">在席確認表【開発用】</button>
      <div id="groupMenu" class="grp-menu" role="menu" aria-labelledby="titleBtn">
        <h4 id="groupMenuTitle">グループにジャンプ</h4>
        <ul id="groupMenuList"></ul>
      </div>
    </div>
    <input id="nameFilter" class="name-filter" type="search" placeholder="氏名検索（入力と同時に絞り込み）" aria-label="氏名検索" />
    <select id="statusFilter" class="status-filter" aria-label="ステータスで絞り込み"></select>
    <button id="adminBtn" class="admin-btn" title="管理">管理</button>
    <button id="logoutBtn" class="logout-btn" title="ログオフ">ログオフ</button>
    <button id="manualBtn" class="manual-btn" title="マニュアル">マニュアル</button>
  </header>

  <!-- 管理モーダル -->
  <div id="adminModal" class="admin-modal" aria-modal="true" role="dialog">
    <div class="admin-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <h3>管理パネル</h3><button id="adminClose">閉じる</button>
      </div>


      <div class="admin-grid">
        <div class="admin-box">
          <h4>CSVエクスポート</h4>
          <div class="admin-row"><button id="btnExport">ダウンロード</button></div>
          <div class="admin-note">形式：グループ番号,グループ名,表示順,id,氏名,内線,ステータス,戻り時間,備考（従来ヘッダも可）</div>
        </div>

        <div class="admin-box">
          <h4>CSVインポート</h4>
          <div class="admin-row"><input type="file" id="csvFile" accept=".csv,text/csv" /><button id="btnImport">取り込み</button></div>
        </div>

        <div class="admin-box">
          <h4>拠点名の変更</h4>
          <div class="admin-row"><input id="renameOfficeName" placeholder="新しい拠点名" /><button id="btnRenameOffice">変更</button></div>
        </div>


        <div class="admin-box">
          <h4>拠点パスワードの変更</h4>
          <div class="admin-row">
            <input id="setPw" placeholder="新パスワード（任意）" />
            <input id="setAdminPw" placeholder="新管理者PW（任意）" />
            <button id="btnSetPw">更新</button>
          </div>
        </div>

        <div class="admin-box">
          <h4>メニュー設定（JSON）</h4>
          <div class="admin-row"><textarea id="menusJson" placeholder='{"statuses":[...], "noteOptions":[...], "timeStepMinutes":30}'></textarea></div>
          <div class="admin-row"><button id="btnLoadMenus">現在の設定を読み込み</button><button id="btnSaveMenus">保存</button></div>
        </div>
      </div>
    </div>
  </div>

  <!-- マニュアルモーダル -->
  <div id="manualModal" class="manual-modal" aria-modal="true" role="dialog" aria-labelledby="manualTitle">
    <div class="manual-card" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <h3 id="manualTitle">マニュアル</h3>
        <button id="manualClose" aria-label="閉じる">閉じる</button>
      </div>

      <section id="manualUser" class="manual-section">
        <h4>ユーザーマニュアル</h4>
        <ol>
          <li><strong>ログイン</strong>
            <ul>
              <li>営業所を選び、パスワードを入力してください</li>
            </ul>
          </li>
          <li><strong>在席確認表【開発用】</strong>
            <ul>
              <li>パネルはチーム（グループ）ごとです。</li>
              <li>画面幅に応じて最大3列。狭い幅ではリスト→カード表示に切り替わります。</li>
              <li>縦スクロールが長い場合、タイトルをクリックでジャンプメニューから目的のグループへ移動できます。</li>
              <li><strong>検索/絞り込み</strong>：ヘッダの氏名検索・ステータス絞りで即時に反映。該当行ゼロのパネルは非表示。</li>
              <li><strong>色分け</strong>：在席（無色）、外出（橙）、会議（青）、テレワーク（紫）、休み（赤）。</li>
              <li><strong>戻り時間</strong>：外出/会議で有効（07:00〜22:00、既定30分刻み）。未入力時は赤枠で促します。</li>
              <li><strong>備考</strong>：自由入力＋候補（空白/直出/直帰/直出・直帰）。入力中は自動更新を保留。</li>
              <li><strong>反映速度</strong>：約2秒で他端末に反映。競合はサーバ時刻採用（CAS設定に依存）。</li>
            </ul>
          </li>
        </ol>
      </section>

      <section id="manualAdmin" class="manual-section">
        <h4>管理者マニュアル</h4>
        <ol>
          <li>CSV入出力、拠点名変更、パスワード変更、メニュー設定（JSON：statuses / noteOptions / timeStepMinutes）に対応。</li>
        </ol>
      </section>
    </div>
  </div>

  <!-- ログイン -->
  <div id="login" class="login" style="display:none">
    <div class="card">
      <h2>在席確認表【開発用】【開発用】</h2>
      <p>拠点を選び、パスワードを入力してください</p>
      <select id="officeSel" aria-label="拠点"></select>
      <input type="password" id="pw" placeholder="Password" autocomplete="current-password" />
      <button id="btnLogin">ログイン</button>
      <div id="loginMsg" style="color:#0073bb;margin-top:8px" aria-live="polite"></div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div class="wrap"><div id="board" class="board" style="display:none"></div></div>
  <div id="diag" class="diag"></div>
  <script src="config.js"></script>
  <script src="main.js"></script>

</body>
</html>
